<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>yotta-blog</title>
  <link rel="stylesheet" href="./css/global.css" />
  <link rel="stylesheet" href="./css/other.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="./css/zui.css" />

  <script type="text/javascript" src="./js/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="./js/zui.min.js"></script>
</head>

<body>
  <div class="yotta-venture">
    <div class="yotta-header">
      <div class="yotta-container animate__animated">
        <div class="yotta-logo"></div>
        <div class="yotta-mobile-maincontain">
          <div class="topbg"></div>
          <div class="ownerinfo">
            <img src="/img/avatar.jpg" />
            <div class="myinfo">
              <h3>文丑</h3>
              <small>nothing ventured,nothing gained</small>
            </div>
          </div>
        </div>
        <div class="yotta-nav-list">
          <div class="yotta-nav-item dropdown dropdown-hover">
            <div><i class="icon icon-file-archive"></i>技术探讨</div>
            <ul class="dropdown-menu">
              <li class="dropdown-submenu">
                <a href="###"><i class="icon icon-file-archive"></i>打开</a>
                <ul class="dropdown-menu">
                  <li><a href="###">运行</a></li>
                  <li><a href="###">在终端中打开</a></li>
                  <li><a href="###">在编辑器中打开</a></li>
                </ul>
              </li>
              <li class="dropdown-submenu">
                <a href="###">一组操作</a>
                <ul class="dropdown-menu">
                  <li class="dropdown-submenu">
                    <a href="###">修改</a>
                    <ul class="dropdown-menu">
                      <li><a href="###">修改标题</a></li>
                      <li><a href="###">更新内容</a></li>
                      <li><a href="###">转移</a></li>
                    </ul>
                  </li>
                  <li class="dropdown-submenu">
                    <a href="###">删除</a>
                    <ul class="dropdown-menu">
                      <li><a href="###">移动到回收站</a></li>
                      <li><a href="###">直接删除</a></li>
                    </ul>
                  </li>
                  <li><a href="###">撤销</a></li>
                </ul>
              </li>
              <li class="dropdown-submenu">
                <a href="###">另一组操作</a>
                <ul class="dropdown-menu">
                  <li><a href="###">评审</a></li>
                  <li><a href="###">计划</a></li>
                  <li><a href="###">关闭</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
        <div class="yotta-search">
          <div class="input-group">
            <div class="input-control search-box search-box-circle has-icon-left has-icon-right search-example"
              id="searchboxExample">
              <input id="inputSearchExample3" type="search" class="form-control search-input" placeholder="搜索" />
              <label for="inputSearchExample3" class="input-control-icon-left search-icon"><i
                  class="icon icon-search"></i></label>
            </div>
            <span class="input-group-btn">
              <button class="btn btn-primary" type="button">搜索</button>
            </span>
          </div>
        </div>
      </div>
      <div class="mobile-nav">
        <div class="sidermasker animate__animated"></div>
        <i class="icon icon-server showSider"></i>
        <i class="icon icon-search showSearch"></i>
        <div class="searchframe animate__animated">
          <input id="inputSearchExample3" type="search" class="form-control search-input" placeholder="搜索" />
          <div class="onsearch"><i class="icon icon-search"></i></div>
        </div>
      </div>
    </div>
    <div class="yotta-main">
      <div class="yotta-main-left">
        <div class="yotta-article-detail">
          <h1>文章标题</h1>
          <div class="attrlist">
            <span><i class="icon icon-beaker"></i>2022-09-06</span>
            <span><i class="icon icon-eye-open"></i>2022</span>
            <span><i class="icon icon-thumbs-o-up"></i>2303</span>
            <span><i cla ss="icon icon-comment-alt"></i>453</span>
            <span><i class="icon icon-folder-close"></i>4</span>

          </div>
          <div class="article-body">
            <div id="yotta-markdown">
              <textarea class="maincontent">
                  代理模式，可以让我们在不修改源对象代码的情况下，对目标对象的方法进行相应的增强。遵循java的开闭原则，即对扩展开放，对修改关闭。



## 动态代理

**代理类在程序运行时创建的代理方式被称为动态代理**。

在java的java.lang.reflect包下提供了一个Proxy类和一个InvocationHandler接口，通过这个类和这个接口可以生成JDK动态代理类和动态代理对象。

这里以联想代理商售卖电脑举例。

真实类与代理类需要实现同一个接口。首先创建一个真是类与代理类的公共接口：

```java
public interface SaleComputer {
    public String sale(double money);
    public void show();
}
```
定义真实类，实现SaleComputer接口
```java
public class Lenovo implements SaleComputer {
    @Override
    public String sale(double money) {
        System.out.println("花了" + money +"块钱买了一台联想电脑");
        return "联想电脑";
    }

    @Override
    public void show() {
        System.out.println("展示电脑");
    }
}
```

创建测试类进行测试

```java
public class ProxyTest {
    public static void main(String[] args) {
        
        //创建真实对象
        Lenovo lenovo = new Lenovo();

        //使用接口接收代理对象
        SaleComputer lenovo_proxy = (SaleComputer)Proxy.newProxyInstance(lenovo.getClass().getClassLoader(),
                lenovo.getClass().getInterfaces(), new InvocationHandler() {
            @Override                      
            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                System.out.println("--------------------调用了一次方法---------------------------");
                if(method.getName() == "show"){
                    System.out.println("打开电脑");
                    method.invoke(lenovo,args);
                }else if (method.getName() == "sale"){
                    args[0] = (double)args[0] * 0.8;
                    method.invoke(lenovo,args[0]);
                    System.out.println("送一张鼠标垫");
                }
                return null;
            }
        });
        lenovo_proxy.show();
        lenovo_proxy.sale(1000);
    }
}
```

**步骤:**

1.创建真实对象

2.使用Proxy.newProxyInstance()方法获取代理对象，该方法需要接收三个参数:

​	①类加载器：真实对象.getClass().getClassLoader()

​	②接口数组：真实对象.getClass().getInterfaces()

​	③处理器：实现InvocationHandler接口的对象

3.在处理器中重写invoke方法，代理对象每调用一次方法都会先执行该方法，该方法有三个形参:

①proxy:代理对象,这里即lenovo_proxy

②method：代理对象调用的方法，被封装为Method对象

③args:代理对象调用的方法时，传递的实际参数

4.在invoke方法里对目标方法进行增强，增强前(后)。使用methtod对象的invoke方法，调用真实对象的方法。

这里我们通过反射对不同的方法进行了不同的增强：

- 若代理对象调用show方法,则在真实对象方法被调用之前会先打开电脑。这种在真实对象的方法调用之前进行的增强，我们称之为前置增强。
- 若代理对象调用sale方法，顾客实际花了1000购买，但是商家只花800即可从联想那里进货，这里就是对参数进行了增强。在真实对象的sale方法执行之后，又赠送了顾客一张鼠标垫。这种在真实对象的方法调用之后进行的增强，我们称之为后置增强。







这里的间接性就是指不直接调用实际对象的方法，那么我们在代理过程中就可以加上一些其他用途

**invoke()方法的返回值总是对象**,如果实际被调用的方法的返回类型是基本类型数据,那么invoke()方法会把它转换为相应的包装类型的对象,再将其返回.

</textarea>
            </div>
            <div class="operation">
              <div class="likethis">

                <p class="hl-red">如果本文对你有用，就给个小爱心吧</p>


                <label for="thumbup">
                  <input type="checkbox" id="thumbup" class="likeanimation" hidden />
                  <svg t="1639041971928" class="icon" viewBox="0 0 1024 1024" version="1.1"
                    xmlns="http://www.w3.org/2000/svg" p-id="3128">
                    <path
                      d="M512 896a42.666667 42.666667 0 0 1-30.293333-12.373333l-331.52-331.946667a224.426667 224.426667 0 0 1 0-315.733333 223.573333 223.573333 0 0 1 315.733333 0L512 282.026667l46.08-46.08a223.573333 223.573333 0 0 1 315.733333 0 224.426667 224.426667 0 0 1 0 315.733333l-331.52 331.946667A42.666667 42.666667 0 0 1 512 896z"
                      p-id="3129" id="heart"></path>
                  </svg>
                  <span></span>
                </label>
                <p class="text-gray" id="thumbsum">33</p>

              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="yotta-main-right">
        <div class="yotta-own-cart">
          <div class="topbg"></div>
          <div class="avatar"><img src="/img/avatar.jpg" /></div>
          <div class="motto">
            <a>文丑</a>
            <em>你这么圣母，应该让乐山大佛的位置让给你坐</em>
          </div>
          <div class="info">
            <div class="statistic">
              <span class="sum">20</span><span class="prop">点赞数</span>
            </div>
            <div class="statistic">
              <span class="sum">20</span><span class="prop">点赞数</span>
            </div>
            <div class="statistic">
              <span class="sum">20</span><span class="prop">点赞数</span>
            </div>
          </div>
        </div>
        <div class="yotta-hot">
          <div class="title"><i class="icon icon-star"></i>最热文章</div>
          <div class="hot-list">
            <div class="hot-item">最近很火的一件事你们</div>
            <div class="hot-item">正火辣兄弟们</div>
          </div>
        </div>
      </div>
    </div>
    <div class="yotta-footer">
      <div class="systeminfo">
        name of the system is yotta. powered by venture
      </div>
    </div>
  </div>
  <!--  <script src="js/jquery.min.js"></script> -->
  <script src="./js/mutual.js"></script>
  <script src="plugins/editor.md/js/marked.min.js"></script>
  <script src="plugins/editor.md/js/prettify.min.js"></script>

  <script src="plugins/editor.md/js/raphael.min.js"></script>
  <script src="plugins/editor.md/js/underscore.min.js"></script>
  <script src="plugins/editor.md/js/sequence-diagram.min.js"></script>
  <script src="plugins/editor.md/js/flowchart.min.js"></script>
  <script src="plugins/editor.md/js/jquery.flowchart.min.js"></script>
  <script src="plugins/editor.md/js/editormd.js"></script>
  <script>
    let thumbsum = $("#thumbsum").html()

    // 解析md
    editormd.markdownToHTML('yotta-markdown', {
      htmlDecode: 'style,script,iframe', // you can filter tags decode
      markdown: $('.maincontent').html().trim(),
      emoji: true,
      taskList: true,
      tex: true, // 默认不解析
      flowChart: true, // 默认不解析
      sequenceDiagram: true // 默认不解析
    })
    $("#heart").on("click", function () {
      if (timeInterval > 0) {
        new $.zui.Messager('你的操作太频繁啦', {
          icon: null,
          time: 1000,
          close: false
        }).show();
        return
      }
      timeInterval = 5
      setTimeout(() => {
        const flag = $("#thumbup").is(':checked')
        $('#thumbup').prop('disabled', true)
        if (flag) {
          $.post("http://localhost:8080/archive/thumbup/" + 2, { "flag": true }, data => {
          }, "json")
          setTimeout(function () {
            $("#thumbsum").html(++thumbsum)
            new $.zui.Messager('点赞成功', {
              icon: 'heart',
              time: 1000,
              close: false
            }).show();
          }, 1200)
        } else {
          $.post("http://localhost:8080/archive/thumbup/" + 2, { "flag": false }, data => {
            $("#thumbsum").html(--thumbsum)
          }, "json")
          new $.zui.Messager('已取消', {
            icon: 'heart',
            time: 1000,
            close: false
          }).show();
        }

      }, 100)
      setTimeout(() => {
        timeInterval = 0
        $('#thumbup').prop('disabled', false)
      }, 5000)
    })
  </script>
  <link rel="stylesheet" href="plugins/editor.md/css/editormd.preview.css" />
</body>

</html>